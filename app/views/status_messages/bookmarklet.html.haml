-#   Copyright (c) 2010-2011, Diaspora Inc.  This file is
-#   licensed under the Affero General Public License version 3 or later.  See
-#   the COPYRIGHT file.

= javascript_include_tag "/javascripts/jquery.js"

= javascript_include_tag "/javascripts/default.js"
= stylesheet_link_tag "diaspora_default", :media => 'all'
= stylesheet_link_tag "blueprint/screen", :media => 'screen'
= javascript_include_tag "publisher.js"

= javascript_include_tag "/javascripts/markitup/jquery.markitup.js"
= javascript_include_tag "/javascripts/markitup/sets/markdown/set.js"
%link{:rel => 'stylesheet', :type => "text/css", :href => '/javascripts/markitup/skins/simple/style.css'}
%link{:rel => 'stylesheet', :type => "text/css", :href => '/javascripts/markitup/sets/markdown/style.css'}



:javascript
  Diaspora.I18n.loadLocale(#{get_javascript_strings_for(current_user.language).to_json}, "#{current_user.language}");
  $(document).ready(function() 
    {
      $('#status_message_fake_text').markItUp(mySettings);
      Publisher.open();
      Publisher.bookmarklet = true;
      $("#publisher").bind('ajax:success', function(){
        Publisher.clear();
        Publisher.close();
        Publisher.open();
        $('input.button')[0].removeAttribute('disabled');
      });

      if ("#{params[:title]}".length > 0){
        contents = contents + "#{params[:title]} ";
        $("#publisher #status_message_fake_text").val(contents);
        $("#publisher #status_message_text").val(contents);
      }
      if ("#{params[:url]}".length > 0){
        contents = contents + "#{params[:url]} ";
        $("#publisher #status_message_fake_text").val(contents);
        $("#publisher #status_message_text").val(contents);
      }
      if ("#{params[:notes]}".length > 0){
        contents = contents + "#{params[:notes]}";
        $("#publisher #status_message_fake_text").val(contents);
        $("#publisher #status_message_text").val(contents);
      }

      $('input.button')[0].removeAttribute('disabled');
  });

#new_status_message_pane
  .span-16.last
    = render :partial => 'shared/publisher', :locals => { :aspect => :profile, :selected_aspects => @aspects,  :aspect_ids => @aspect_ids }

